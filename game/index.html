<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=, initial-scale=1.0">
    <title>Document</title>
    <style>
        canvas {
            background-color: beige;
        }
    </style>

</head>

<body>
    <canvas id="canvas" width="680" height="1120"></canvas>


    <script type="text/javascript">

        var cv = null;
        var ctx = null;
        var player1 = null;
        var maxX = 1, maxY = 0;
        var pla2X = 16, pla2Y = 26;
        var direction = 'left';
        var player2 = null;
        var acore = 0;
        var pause = false;
        var pared = null;

        var shiru = new Image();
        var hojitas = new Image();
        var ninja = new Image();
        var audio = new Audio();
        var suelito = new Image();
        var pared2 = null;
        var matriz = new Array();
        //y 28* x17

        matriz = [
            ["1", "0", "0", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1"],
            ["1", "0", "0", "1", "1", "0", "0", "0", "1", "1", "1", "1", "1", "1", "1", "1", "1"],
            ["1", "0", "1", "0", "0", "0", "1", "0", "0", "1", "1", "1", "1", "1", "1", "1", "1"],
            ["1", "0", "1", "0", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1"],
            ["1", "0", "1", "0", "0", "1", "0", "0", "1", "1", "1", "1", "1", "1", "1", "1", "1"],
            ["1", "0", "1", "1", "0", "0", "1", "0", "1", "1", "1", "1", "1", "1", "1", "1", "1"],
            ["1", "0", "1", "1", "0", "1", "1", "0", "1", "1", "1", "1", "1", "1", "1", "1", "1"],
            ["1", "0", "0", "0", "0", "1", "1", "0", "1", "1", "1", "1", "1", "1", "1", "1", "1"],
            ["1", "1", "0", "1", "1", "0", "0", "0", "1", "1", "1", "1", "1", "1", "1", "1", "1"],
            ["1", "0", "0", "1", "1", "0", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1"],
            ["1", "0", "1", "1", "1", "0", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1"],
            ["1", "0", "0", "0", "0", "0", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1"],
            ["1", "1", "0", "1", "1", "0", "0", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1"],
            ["1", "0", "0", "0", "0", "1", "0", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1"],
            ["1", "0", "1", "1", "0", "1", "0", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1"],
            ["1", "0", "1", "1", "0", "1", "0", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1"],
            ["1", "0", "0", "0", "1", "1", "0", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1"],
            ["1", "1", "1", "0", "1", "1", "0", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1"],
            ["1", "1", "0", "0", "1", "1", "0", "1", "0", "0", "0", "1", "1", "1", "1", "1", "1"],
            ["1", "0", "1", "1", "0", "0", "0", "1", "1", "1", "0", "1", "1", "1", "1", "1", "1"],
            ["1", "0", "0", "0", "0", "1", "1", "1", "1", "1", "0", "1", "1", "0", "1", "1", "1"],
            ["1", "1", "1", "1", "0", "0", "0", "0", "1", "1", "0", "1", "1", "0", "1", "1", "1"],
            ["1", "1", "1", "1", "1", "1", "1", "0", "1", "0", "0", "0", "0", "0", "1", "1", "1"],
            ["1", "1", "1", "1", "1", "1", "1", "0", "1", "1", "1", "1", "1", "0", "1", "1", "1"],
            ["1", "1", "1", "1", "1", "1", "1", "0", "0", "0", "0", "0", "1", "0", "1", "1", "1"],
            ["1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "0", "1", "1", "0", "0", "0", "1"],
            ["1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "0", "0", "0", "0", "1", "0", "0"],
            ["1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1"],];



        function start() {

            cv = document.getElementById("canvas");
            ctx = cv.getContext("2d");
            player1 = new Cuadraro(maxX * 40, maxY * 40, 40, 40, 'blue');
            player2 = new Cuadraro(pla2X * 40, pla2Y * 40, 40, 40, 'red');
            
            shiru.src = 'der.gif';
            hojitas.src = 'pared.png';
            ninja.src = 'sakuraa.png';
            audio.src = 'sonido.mp3';
            suelito.src = 'suelo.png';
            paint();


        }
        function paint() {
            window.requestAnimationFrame(paint);
            player1.dibujar(ctx);
            ctx.drawImage(ninja, player2.x, player2.y);
            for (var i = 0; i < 28; i++) {
                for (var j = 0; j < 17; j++) {
                    var posx = i * 40;
                    var posy = j * 40;
                    if (matriz[i][j] == 1) {
                        pared = new Cuadraro(posy, posx * 40, 40, 40, 'red');
                        ctx.drawImage(hojitas, posy, posx,40,40);
                    } else if (matriz[i][j] == 0) {
                        pared = new Cuadraro(posy, posx * 40, 40, 40, 'red');
                        ctx.drawImage(suelito, posy, posx,40,40);
                    }
                }
            }
            player1.dibujar(ctx);
            ctx.drawImage(ninja, player2.x, player2.y);
            
            if (pause) {
                ctx.fillStyle = "rgba(0,0,0,0.5)";
                ctx.fillRect(0, 0, 680, 1120);
                ctx.fillStyle = "#fff";
                ctx.font = "20px Courier";
                ctx.fillText("Pause", 340, 500);
            }

        }

      

        window.addEventListener('load', start)

        window.requestAnimationFrame = (function () {
            return window.requestAnimationFrame ||
                window.webkitRequestAnimationFrame ||
                window.mozRequestAnimationFrame ||
                function (callback) {
                    window.setTimeout(callback, 17);
                };
        }());

        function update() {
            //DERECHA
            if (direction == 'right') {
                if (player1.se_tocan(pared)) {
                    player1.x = player1.x - 40;
                } else {
                    player1.x += 40;
                    if (player1.x >= 680) {
                        player1.x = 0;
                    }
                }
            }
            //IZQUIERDA
            if (direction == 'left') {
                if (player1.se_tocan(pared)) {
                    player1.x = player1.x + 40;
                } else {
                    player1.x -= 40;
                    if (player1.x < 0) {
                        player1.x = 640;
                    }
                }
            }
            //ABAJO
            if (direction == 'down') {
                if (player1.se_tocan(pared)) {
                    player1.y = player1.y - 40;
                } else {
                    player1.y += 40;
                    if (player1.y >= 1120) {
                        player1.y = 0;
                    }
                }
            }
            //ARRIBA
            if (direction == 'up') {
                if (player1.se_tocan(pared)) {
                    player1.y = player1.y + 40;
                } else {
                    player1.y -= 40;
                    if (player1.y < 0) {
                        player1.y = 1080;
                    }
                }
            }

            if (player1.se_tocan(player2)) {
                player2.x = generateRandomInteger(460);
                player2.y = generateRandomInteger(460);
               
                audio.play();
                if (player2.se_tocan(pared)) {
                    player2.x = generateRandomInteger(460);
                    player2.y = generateRandomInteger(460);
                }

            }

        }

        document.addEventListener("keydown", function (e) {
            console.log(e);
            //ARRIBA
            if (e.which == 87) {
                direction = 'up'
                update()
            }
            //ABAJO
            if (e.which == 83) {
                direction = 'down'
                update()
            }
            //IZQUIERDA
            if (e.which == 65) {
                direction = 'left'
                update()
            }
            //DERECHA
            if (e.which == 68) {
                direction = 'right'
                update()
            }
            //PAUSA
            if (e.which == 32) {
                if (!pause) {
                    pause = true;
                } else {
                    pause = false;
                }

            }

        });


        function Cuadraro(x, y, w, h, c) {
            this.x = x;
            this.y = y;
            this.w = w;
            this.h = h;
            this.c = c;
            this.se_tocan = function (target) {
                if (this.x < target.x + target.w &&
                    this.x + this.w > target.x &&
                    this.y < target.y + target.h &&
                    this.y + this.h > target.y) {
                    return true;
                }
            };
            this.dibujar = function (ctx) {
                ctx.fillStyle = this.c;
                ctx.fillRect(this.x, this.y, this.w, this.h);
                ctx.strokeRect(this.x, this.y, this.w, this.h);
            }
        }


    </script>


</body>

</html>